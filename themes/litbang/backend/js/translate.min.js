(function(g){var k={apiKey:"",apiURL:"https://translate.yandex.net/api/v1.5/tr.json/translate?",$items:null,$preloader:null,initialLang:"",cache:null,textsStorageName:"translate-texts",langStorageName:"translate-lang",texts:[],requests:[],renderCallback:null,init:function(a){a.apiKey?(this.apiKey=a.apiKey,this.initialLang=a.load||"",this.cache=a.cache||null,this.renderCallback=a.renderCallback||function(){},this.$items=g("[data-translate]"),this.$preloader=g("[data-translate-preloader]"),this.texts=
this.collect(),this.eventEvents()):console.log("No api key is provided. Please check https://tech.yandex.com/translate/")},findLang:function(a,c){for(var b=0;b<a.length;b++)if(a[b].sourceLang===c)return a[b];return null},findTextByIdHelper:function(a,c){if(c)for(var b=0;b<c.texts.length;b++)if(c.texts[b].id===a)return c.texts[b];return""},findTextById:function(a,c){if(c)return this.findTextByIdHelper(a,c);for(var b=0;b<this.texts.length;b++){var d=this.findTextByIdHelper(a,this.texts[b]);if(d)return d}return""},
collect:function(){var a=[],c=this;this.$items&&this.$items.each(function(b,d){var f=g(this),e=f.data("translate");f.attr("data-translate-id",b);if(e){var h=c.findLang(a,e),f={source:f.html(),id:b};h?h.texts.push(f):a.push({sourceLang:e,texts:[f]})}});return a},getRequests:function(a){var c=[];if(0<this.texts.length)for(var b=0;b<this.texts.length;b++){for(var d=this.texts[b],f="format=html&options=1&lang="+d.sourceLang+"-"+a,e=0;e<d.texts.length;e++)f+="&text="+d.texts[e].source;c.push(f)}return c},
saveToCookies:function(a,c,b){var d=new Date;b=Number(b);-1==b||isNaN(b)?document.cookie=a+"="+c+";path=/;":(d.setMinutes(d.getMinutes()+b),document.cookie=a+"="+c+";path=/; expires="+d.toUTCString())},getFromCookies:function(a){var c,b,d,f=null;d=document.cookie.split(";");for(var e=0;e<d.length;e++)if(c=d[e].substr(0,d[e].indexOf("=")),b=d[e].substr(d[e].indexOf("=")+1),c=c.replace(/^\s+|\s+$/g,""),c==a){f=b;break}return f},saveTextsToCache:function(){"localstorage"===this.cache&&window.localStorage&&
(window.localStorage[this.textsStorageName]=JSON.stringify(this.texts));"cookies"===this.cache&&this.saveToCookies(this.textsStorageName,JSON.stringify(this.texts),-1)},saveLangToCache:function(a){"localstorage"===this.cache&&window.localStorage&&(window.localStorage[this.langStorageName]=a);"cookies"===this.cache&&this.saveToCookies(this.langStorageName,a,-1)},getTextsFromCache:function(){var a="",c=null;"localstorage"===this.cache&&window.localStorage&&(a=window.localStorage[this.textsStorageName]);
"cookies"===this.cache&&(a=this.getFromCookies(this.textsStorageName));a&&(c=jQuery.parseJSON(a));return c},getLangFromCache:function(){var a="";"localstorage"===this.cache&&window.localStorage&&(a=window.localStorage[this.langStorageName]);"cookies"===this.cache&&(a=this.getFromCookies(this.langStorageName));return a},translate:function(a){var c=this;c.cache&&c.saveLangToCache(a);for(var b=0;b<this.requests.length;b++)c.$preloader.addClass("show"),g.ajax({url:this.apiURL+"key="+this.apiKey,type:"POST",
dataType:"json",cache:!1,data:this.requests[b]}).done(function(b){if(b&&200===b.code){var d=b.lang.replace("-"+a,""),e=c.findLang(c.texts,d);if(e&&e.texts.length===b.text.length)for(var g=0;g<e.texts.length;g++)e.texts[g].target=b.text[g];c.renderLang(d,e);c.cache&&c.saveTextsToCache()}}).always(function(){c.$preloader.removeClass("show")})},renderLang:function(a,c){var b=this;this.$items.filter('[data-translate="'+a+'"]').each(function(){var a=g(this),f=Number(a.attr("data-translate-id")),f=b.findTextById(f,
c);a.html(f.target)});b.renderCallback()},restore:function(a){var c=this;this.$items.each(function(){var b=g(this),d=Number(b.attr("data-translate-id"));(d=c.findTextById(d))&&b.html(d[a])});c.renderCallback()},eventEvents:function(){var a=this;g("[data-translate-btn]").on("click",function(){var c=g(this).attr("data-translate-btn");"original"===c?(a.restore("source"),a.cache&&a.saveLangToCache("original")):(a.requests=a.getRequests(c),a.translate(c))});(this.initialLang||this.cache)&&g(document).ready(function(){var c=
null,b;a.cache&&(c=a.getTextsFromCache(),b=a.getLangFromCache());c&&b&&"original"!==b?(a.texts=c,a.restore("target")):a.initialLang&&(a.requests=a.getRequests(a.initialLang),a.translate(a.initialLang))})}};jQuery.translate=function(a){k.init(a)}})(jQuery);
