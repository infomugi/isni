<?php
class SearchData extends CActiveRecord
{
    public static function model($className=__CLASS__)
    {
        return parent::model($className);
    }

    // Show Istilah Teknis
    public static function getIstilahTeknis(){
        $sql = "
        select tb_istilah.id_istilah, tb_istilah.istilah, tb_istilah.definisi, tb_istilah.id_bidang, tbbidang.nm_bidang1 as nama_bidang, tb_istilah.no_id, v_standar.judul1, v_standar.no_nspm_gab from tb_istilah left outer join (select distinct m_standar.no_id, m_standar.no_nspm, m_standar.judul1, m_standar.ruang1, case when (m_standar.no_nspm is not null and m_standar.no_nspm <> '') then m_standar.no_nspm else m_standar.no_nspm_konsep end as no_nspm_gab, case when (m_standar.kd_status_standar is not null and m_standar.kd_status_standar <> '') then m_standar.kd_status_standar else case when m_standar.thn_penetapan_rsni is not null and m_standar.thn_penetapan_rsni <> '' then m_standar.kd_kat_standar_konsep else '10'end end as kd_status_standar_gab from m_standar as m_standar ) as v_standar on tb_istilah.no_id = v_standar.no_id left outer join tbbidang on tb_istilah.id_bidang = tbbidang.kd_bidang where 1 = 1 order by id_bidang,istilah
        ";
        $command = YII::app()->db->createCommand($sql);
        return $command->queryAll();
    }    

    // Show Bidang
    public static function getBidang(){
        $sql = "
        SELECT nm_bidang1 as nama_bidang FROM tbbidang ORDER BY kd_bidang
        ";
        $command = YII::app()->db->createCommand($sql);
        return $command->queryAll();
    }       

    // Show SMM : Daftar Sistem Manajemen Mutu (SMM) Balitbang PU
    public static function getSMM(){
        $sql = "
        SELECT * FROM tm_publik WHERE id_subject = '2' ORDER BY judul 
        ";
        $command = YII::app()->db->createCommand($sql);
        return $command->queryAll();
    } 

    // Show SMM : Daftar Sistem Manajemen Mutu (SMM) Balitbang PU
    public static function getJudulSMM(){
        $sql = "
        SELECT judul FROM tm_publik WHERE id_subject = '2' ORDER BY judul 
        ";
        $command = YII::app()->db->createCommand($sql);
        return $command->queryAll();
    }   

    // Show SNI : NSPM, Judul, Ruang Lingkup
    public static function getSNI($id){
        $sql = "
        select no_id as id, no_nspm_gab as no_nspm, judul1 as judul, ruang1 as ruang_lingkup, nm_bidang as nama_bidang, tg_kepbsn as tahun from (select distinct m_standar.no_id, m_standar.no_nspm, m_standar.judul1, m_standar.ruang1, m_standar.kd_gugus, tbgugus.nm_gugus, m_standar.kd_patek, tbpatek.nm_patek, m_standar.kd_subpatek, tbsubpatek.nm_subpatek, m_standar.kd_unit, tbunit.nm_unit, m_standar.kd_dana, tbdana.nm_dana, m_standar.kd_list_kategori, tb_list_kategori.nm_list_kategori1, m_standar.kd_jenis_standar, tbjenis_standar.nm_jenis_standar1, m_standar.kd_padanan, tb_padanan.no_padanan, m_standar.tgl_usul, m_standar.tgl_rsni1, m_standar.tgl_rsni2, m_standar.tgl_rsni3, m_standar.tgl_rsni4, m_standar.no_kepbsn, m_standar.tg_kepbsn, m_standar.kd_status_standar, tb_status_standar1.nm_kategori1, m_standar.kd_status_nspm, tbstatus.nm_status, m_standar.kd_jenisstatus, tbjenisstatus.nm_jenisstatus, m_standar.berlaku, m_standar.tgl_pantek, m_standar.log_revisi, m_standar.tgl_save, m_standar.tgl_update, m_standar.user_id, m_standar.judul1 + ' - ' + m_standar.ruang1 as textcari, m_standar.lp_perencanaan, m_standar.lp_desain, m_standar.lp_kontruksi, m_standar.lp_om, m_standar.tgl_usulbsn, m_standar.tgl_bsn, m_standar.jmlhal, m_standar.no_nspm_rev, m_standar.no_revisi, m_standar.status_rev, m_standar.no_ics, v_ics_tampil.nama_subsubics, m_standar.statusws, m_standar.statustek, m_standar.d_acuan, m_standar.d_pendamping, tb_padanan.deskripsi as deskripsi_padanan, m_standar.d_terkait, m_standar.tahap_usulan, m_standar.tahap_konsep, m_standar.tahap_rpt_teknis1, m_standar.tahap_rpt_teknis2, m_standar.tahap_rpt_konsensus, m_standar.tahap_rpt_pantek, m_standar.tahap_usulan_menteri, m_standar.tahap_usulan_bsn, m_standar.tahap_jajak_pendapat, m_standar.tahap_ebaloting, m_standar.jangka_waktu, m_standar.tgl_konsep, m_standar.tgl_rpt_teknis1, m_standar.tgl_rpt_teknis2, m_standar.tgl_rpt_konsensus, m_standar.tgl_rpt_pantek, m_standar.tgl_usulan_thp_menteri, m_standar.tgl_usulan_thp_bsn, m_standar.tgl_jajak_pendapat, m_standar.tgl_ebaloting, m_standar.revisi_dari_spm, tb_list_kategori.kd_bidang, mst_bidang.nm_bidang, m_standar.thn_penetapan_rsni, m_standar.no_kepmen_rsni, m_standar.kd_kat_standar_konsep, m_standar.no_nspm_konsep, v_ics_tampil.kd_ics, v_ics_tampil.kd_subics, tb_status_standar_2.nm_kategori1 as nm_kat_status_standar, case when (m_standar.no_nspm is not null and m_standar.no_nspm <> '') then m_standar.no_nspm else m_standar.no_nspm_konsep end as no_nspm_gab, case when (m_standar.kd_status_standar is not null and m_standar.kd_status_standar <> '') then m_standar.kd_status_standar else case when m_standar.thn_penetapan_rsni is not null and m_standar.thn_penetapan_rsni <> '' then m_standar.kd_kat_standar_konsep else '10'end end as kd_status_standar_gab, case when (tb_status_standar1.nm_kategori1 is not null and tb_status_standar1.nm_kategori1 <> '') then tb_status_standar1.nm_kategori1 else tb_status_standar_2.nm_kategori1 end as nm_status_standar_gab, m_standar_1.judul1 as judul_spm_revisi, m_standar.d_ics, m_standar.d_sni_revisi, m_standar.d_stdacuan, m_standar.d_bibliografi, m_standar.regulasi, m_standar.konseptor, m_standar.kesepakatan_regional, m_standar.kebutuhan_pasar, m_standar.pertimbangan_lain, m_standar.penelitian, m_standar.tgl_usulan_menteri, m_standar.ket_jajak_pendapat, m_standar.ket_ebaloting, m_standar.no_sk_abolisi, m_standar.strata_penggunaan_sni, m_standar.std_non_internasional, m_standar.file_isi, m_standar.file_ringkasan from m_standar as m_standar left outer join (select revisi_dari_spm, judul1, no_nspm from m_standar as m_standar_2 where (no_nspm <> '') ) as m_standar_1 on m_standar.revisi_dari_spm = m_standar_1.no_nspm left outer join (select kd_kategori, nm_kategori1 from tb_status_standar ) as tb_status_standar_2 on m_standar.kd_kat_standar_konsep = tb_status_standar_2.kd_kategori left outer join (select kd_subsub_ics, nama_subsubics, kd_ics, kd_subics from v_ics_tampil ) as v_ics_tampil on m_standar.no_ics = v_ics_tampil.kd_subsub_ics left outer join (select kd_gugus, nm_gugus from tbgugus ) as tbgugus on m_standar.kd_gugus = tbgugus.kd_gugus left outer join (select kd_patek, nm_patek from tbpatek ) as tbpatek on m_standar.kd_patek = tbpatek.kd_patek left outer join (select kd_subpatek, nm_subpatek from tbsubpatek ) as tbsubpatek on m_standar.kd_subpatek = tbsubpatek.kd_subpatek left outer join (select kd_unit, nm_unit from tbunit ) as tbunit on m_standar.kd_unit = tbunit.kd_unit left outer join (select kd_dana, nm_dana from tbdana ) as tbdana on m_standar.kd_dana = tbdana.kd_dana left outer join (select kd_jenis_standar, nm_jenis_standar1 from tbjenis_standar ) as tbjenis_standar on m_standar.kd_jenis_standar = tbjenis_standar.kd_jenis_standar left outer join (select kd_padanan, no_padanan, deskripsi from tb_padanan ) as tb_padanan on m_standar.kd_padanan = tb_padanan.kd_padanan left outer join (select kd_kategori, nm_kategori1 from tb_status_standar ) as tb_status_standar1 on tb_status_standar1.kd_kategori = m_standar.kd_status_standar left outer join (select kd_status, nm_status from tbstatus ) as tbstatus on m_standar.kd_status_nspm = tbstatus.kd_status left outer join (select kd_jenisstatus, nm_jenisstatus from tbjenisstatus ) as tbjenisstatus on m_standar.kd_jenisstatus = tbjenisstatus.kd_jenisstatus left outer join (select kd_bidang, nm_bidang from mst_bidang ) as mst_bidang inner join (select kd_list_kategori, nm_list_kategori1, kd_bidang from tb_list_kategori ) as tb_list_kategori on mst_bidang.kd_bidang = tb_list_kategori.kd_bidang on m_standar.kd_list_kategori = tb_list_kategori.kd_list_kategori ) as v_standar where kd_status_standar = ".$id." and kd_jenisstatus <> '03'and kd_status_standar_gab in ('01', '02', '03') 
        "; $command = YII::app()->db->createCommand($sql);
        return $command->queryAll();
    } 

    // Show SNI : Menampilkan Data Random Standar di Halaman Depan
    public static function get_show_SNI_home($id){
        $sql = "
        select no_id as id, no_nspm_gab as no_nspm, judul1 as judul, ruang1 as ruang_lingkup, nm_bidang as nama_bidang from (select distinct m_standar.no_id, m_standar.no_nspm, m_standar.judul1, m_standar.ruang1, m_standar.kd_gugus, tbgugus.nm_gugus, m_standar.kd_patek, tbpatek.nm_patek, m_standar.kd_subpatek, tbsubpatek.nm_subpatek, m_standar.kd_unit, tbunit.nm_unit, m_standar.kd_dana, tbdana.nm_dana, m_standar.kd_list_kategori, tb_list_kategori.nm_list_kategori1, m_standar.kd_jenis_standar, tbjenis_standar.nm_jenis_standar1, m_standar.kd_padanan, tb_padanan.no_padanan, m_standar.tgl_usul, m_standar.tgl_rsni1, m_standar.tgl_rsni2, m_standar.tgl_rsni3, m_standar.tgl_rsni4, m_standar.no_kepbsn, m_standar.tg_kepbsn, m_standar.kd_status_standar, tb_status_standar1.nm_kategori1, m_standar.kd_status_nspm, tbstatus.nm_status, m_standar.kd_jenisstatus, tbjenisstatus.nm_jenisstatus, m_standar.berlaku, m_standar.tgl_pantek, m_standar.log_revisi, m_standar.tgl_save, m_standar.tgl_update, m_standar.user_id, m_standar.judul1 + ' - ' + m_standar.ruang1 as textcari, m_standar.lp_perencanaan, m_standar.lp_desain, m_standar.lp_kontruksi, m_standar.lp_om, m_standar.tgl_usulbsn, m_standar.tgl_bsn, m_standar.jmlhal, m_standar.no_nspm_rev, m_standar.no_revisi, m_standar.status_rev, m_standar.no_ics, v_ics_tampil.nama_subsubics, m_standar.statusws, m_standar.statustek, m_standar.d_acuan, m_standar.d_pendamping, tb_padanan.deskripsi as deskripsi_padanan, m_standar.d_terkait, m_standar.tahap_usulan, m_standar.tahap_konsep, m_standar.tahap_rpt_teknis1, m_standar.tahap_rpt_teknis2, m_standar.tahap_rpt_konsensus, m_standar.tahap_rpt_pantek, m_standar.tahap_usulan_menteri, m_standar.tahap_usulan_bsn, m_standar.tahap_jajak_pendapat, m_standar.tahap_ebaloting, m_standar.jangka_waktu, m_standar.tgl_konsep, m_standar.tgl_rpt_teknis1, m_standar.tgl_rpt_teknis2, m_standar.tgl_rpt_konsensus, m_standar.tgl_rpt_pantek, m_standar.tgl_usulan_thp_menteri, m_standar.tgl_usulan_thp_bsn, m_standar.tgl_jajak_pendapat, m_standar.tgl_ebaloting, m_standar.revisi_dari_spm, tb_list_kategori.kd_bidang, mst_bidang.nm_bidang, m_standar.thn_penetapan_rsni, m_standar.no_kepmen_rsni, m_standar.kd_kat_standar_konsep, m_standar.no_nspm_konsep, v_ics_tampil.kd_ics, v_ics_tampil.kd_subics, tb_status_standar_2.nm_kategori1 as nm_kat_status_standar, case when (m_standar.no_nspm is not null and m_standar.no_nspm <> '') then m_standar.no_nspm else m_standar.no_nspm_konsep end as no_nspm_gab, case when (m_standar.kd_status_standar is not null and m_standar.kd_status_standar <> '') then m_standar.kd_status_standar else case when m_standar.thn_penetapan_rsni is not null and m_standar.thn_penetapan_rsni <> '' then m_standar.kd_kat_standar_konsep else '10'end end as kd_status_standar_gab, case when (tb_status_standar1.nm_kategori1 is not null and tb_status_standar1.nm_kategori1 <> '') then tb_status_standar1.nm_kategori1 else tb_status_standar_2.nm_kategori1 end as nm_status_standar_gab, m_standar_1.judul1 as judul_spm_revisi, m_standar.d_ics, m_standar.d_sni_revisi, m_standar.d_stdacuan, m_standar.d_bibliografi, m_standar.regulasi, m_standar.konseptor, m_standar.kesepakatan_regional, m_standar.kebutuhan_pasar, m_standar.pertimbangan_lain, m_standar.penelitian, m_standar.tgl_usulan_menteri, m_standar.ket_jajak_pendapat, m_standar.ket_ebaloting, m_standar.no_sk_abolisi, m_standar.strata_penggunaan_sni, m_standar.std_non_internasional, m_standar.file_isi, m_standar.file_ringkasan from m_standar as m_standar left outer join (select revisi_dari_spm, judul1, no_nspm from m_standar as m_standar_2 where (no_nspm <> '') ) as m_standar_1 on m_standar.revisi_dari_spm = m_standar_1.no_nspm left outer join (select kd_kategori, nm_kategori1 from tb_status_standar ) as tb_status_standar_2 on m_standar.kd_kat_standar_konsep = tb_status_standar_2.kd_kategori left outer join (select kd_subsub_ics, nama_subsubics, kd_ics, kd_subics from v_ics_tampil ) as v_ics_tampil on m_standar.no_ics = v_ics_tampil.kd_subsub_ics left outer join (select kd_gugus, nm_gugus from tbgugus ) as tbgugus on m_standar.kd_gugus = tbgugus.kd_gugus left outer join (select kd_patek, nm_patek from tbpatek ) as tbpatek on m_standar.kd_patek = tbpatek.kd_patek left outer join (select kd_subpatek, nm_subpatek from tbsubpatek ) as tbsubpatek on m_standar.kd_subpatek = tbsubpatek.kd_subpatek left outer join (select kd_unit, nm_unit from tbunit ) as tbunit on m_standar.kd_unit = tbunit.kd_unit left outer join (select kd_dana, nm_dana from tbdana ) as tbdana on m_standar.kd_dana = tbdana.kd_dana left outer join (select kd_jenis_standar, nm_jenis_standar1 from tbjenis_standar ) as tbjenis_standar on m_standar.kd_jenis_standar = tbjenis_standar.kd_jenis_standar left outer join (select kd_padanan, no_padanan, deskripsi from tb_padanan ) as tb_padanan on m_standar.kd_padanan = tb_padanan.kd_padanan left outer join (select kd_kategori, nm_kategori1 from tb_status_standar ) as tb_status_standar1 on tb_status_standar1.kd_kategori = m_standar.kd_status_standar left outer join (select kd_status, nm_status from tbstatus ) as tbstatus on m_standar.kd_status_nspm = tbstatus.kd_status left outer join (select kd_jenisstatus, nm_jenisstatus from tbjenisstatus ) as tbjenisstatus on m_standar.kd_jenisstatus = tbjenisstatus.kd_jenisstatus left outer join (select kd_bidang, nm_bidang from mst_bidang ) as mst_bidang inner join (select kd_list_kategori, nm_list_kategori1, kd_bidang from tb_list_kategori ) as tb_list_kategori on mst_bidang.kd_bidang = tb_list_kategori.kd_bidang on m_standar.kd_list_kategori = tb_list_kategori.kd_list_kategori ) as v_standar where kd_status_standar = ".$id." and kd_jenisstatus <> '03'and kd_status_standar_gab in ('01', '02', '03') order by rand() limit 2
        "; $command = YII::app()->db->createCommand($sql);
        return $command->queryAll();
    }     

    // Show SNI : Menampilkan Jumlah Total dari Jenis SNI, Pedoman dan Petunjuk
    public static function get_count_SNI($id,$start,$end){
        $sql = "
        select count(no_nspm_gab), tg_kepbsn as tahun from (select distinct m_standar.no_id, m_standar.no_nspm, m_standar.judul1, m_standar.ruang1, m_standar.kd_gugus, tbgugus.nm_gugus, m_standar.kd_patek, tbpatek.nm_patek, m_standar.kd_subpatek, tbsubpatek.nm_subpatek, m_standar.kd_unit, tbunit.nm_unit, m_standar.kd_dana, tbdana.nm_dana, m_standar.kd_list_kategori, tb_list_kategori.nm_list_kategori1, m_standar.kd_jenis_standar, tbjenis_standar.nm_jenis_standar1, m_standar.kd_padanan, tb_padanan.no_padanan, m_standar.tgl_usul, m_standar.tgl_rsni1, m_standar.tgl_rsni2, m_standar.tgl_rsni3, m_standar.tgl_rsni4, m_standar.no_kepbsn, m_standar.tg_kepbsn, m_standar.kd_status_standar, tb_status_standar1.nm_kategori1, m_standar.kd_status_nspm, tbstatus.nm_status, m_standar.kd_jenisstatus, tbjenisstatus.nm_jenisstatus, m_standar.berlaku, m_standar.tgl_pantek, m_standar.log_revisi, m_standar.tgl_save, m_standar.tgl_update, m_standar.user_id, m_standar.judul1 + ' - ' + m_standar.ruang1 as textcari, m_standar.lp_perencanaan, m_standar.lp_desain, m_standar.lp_kontruksi, m_standar.lp_om, m_standar.tgl_usulbsn, m_standar.tgl_bsn, m_standar.jmlhal, m_standar.no_nspm_rev, m_standar.no_revisi, m_standar.status_rev, m_standar.no_ics, v_ics_tampil.nama_subsubics, m_standar.statusws, m_standar.statustek, m_standar.d_acuan, m_standar.d_pendamping, tb_padanan.deskripsi as deskripsi_padanan, m_standar.d_terkait, m_standar.tahap_usulan, m_standar.tahap_konsep, m_standar.tahap_rpt_teknis1, m_standar.tahap_rpt_teknis2, m_standar.tahap_rpt_konsensus, m_standar.tahap_rpt_pantek, m_standar.tahap_usulan_menteri, m_standar.tahap_usulan_bsn, m_standar.tahap_jajak_pendapat, m_standar.tahap_ebaloting, m_standar.jangka_waktu, m_standar.tgl_konsep, m_standar.tgl_rpt_teknis1, m_standar.tgl_rpt_teknis2, m_standar.tgl_rpt_konsensus, m_standar.tgl_rpt_pantek, m_standar.tgl_usulan_thp_menteri, m_standar.tgl_usulan_thp_bsn, m_standar.tgl_jajak_pendapat, m_standar.tgl_ebaloting, m_standar.revisi_dari_spm, tb_list_kategori.kd_bidang, mst_bidang.nm_bidang, m_standar.thn_penetapan_rsni, m_standar.no_kepmen_rsni, m_standar.kd_kat_standar_konsep, m_standar.no_nspm_konsep, v_ics_tampil.kd_ics, v_ics_tampil.kd_subics, tb_status_standar_2.nm_kategori1 as nm_kat_status_standar, case when (m_standar.no_nspm is not null and m_standar.no_nspm <> '') then m_standar.no_nspm else m_standar.no_nspm_konsep end as no_nspm_gab, case when (m_standar.kd_status_standar is not null and m_standar.kd_status_standar <> '') then m_standar.kd_status_standar else case when m_standar.thn_penetapan_rsni is not null and m_standar.thn_penetapan_rsni <> '' then m_standar.kd_kat_standar_konsep else '10'end end as kd_status_standar_gab, case when (tb_status_standar1.nm_kategori1 is not null and tb_status_standar1.nm_kategori1 <> '') then tb_status_standar1.nm_kategori1 else tb_status_standar_2.nm_kategori1 end as nm_status_standar_gab, m_standar_1.judul1 as judul_spm_revisi, m_standar.d_ics, m_standar.d_sni_revisi, m_standar.d_stdacuan, m_standar.d_bibliografi, m_standar.regulasi, m_standar.konseptor, m_standar.kesepakatan_regional, m_standar.kebutuhan_pasar, m_standar.pertimbangan_lain, m_standar.penelitian, m_standar.tgl_usulan_menteri, m_standar.ket_jajak_pendapat, m_standar.ket_ebaloting, m_standar.no_sk_abolisi, m_standar.strata_penggunaan_sni, m_standar.std_non_internasional, m_standar.file_isi, m_standar.file_ringkasan from m_standar as m_standar left outer join (select revisi_dari_spm, judul1, no_nspm from m_standar as m_standar_2 where (no_nspm <> '') ) as m_standar_1 on m_standar.revisi_dari_spm = m_standar_1.no_nspm left outer join (select kd_kategori, nm_kategori1 from tb_status_standar ) as tb_status_standar_2 on m_standar.kd_kat_standar_konsep = tb_status_standar_2.kd_kategori left outer join (select kd_subsub_ics, nama_subsubics, kd_ics, kd_subics from v_ics_tampil ) as v_ics_tampil on m_standar.no_ics = v_ics_tampil.kd_subsub_ics left outer join (select kd_gugus, nm_gugus from tbgugus ) as tbgugus on m_standar.kd_gugus = tbgugus.kd_gugus left outer join (select kd_patek, nm_patek from tbpatek ) as tbpatek on m_standar.kd_patek = tbpatek.kd_patek left outer join (select kd_subpatek, nm_subpatek from tbsubpatek ) as tbsubpatek on m_standar.kd_subpatek = tbsubpatek.kd_subpatek left outer join (select kd_unit, nm_unit from tbunit ) as tbunit on m_standar.kd_unit = tbunit.kd_unit left outer join (select kd_dana, nm_dana from tbdana ) as tbdana on m_standar.kd_dana = tbdana.kd_dana left outer join (select kd_jenis_standar, nm_jenis_standar1 from tbjenis_standar ) as tbjenis_standar on m_standar.kd_jenis_standar = tbjenis_standar.kd_jenis_standar left outer join (select kd_padanan, no_padanan, deskripsi from tb_padanan ) as tb_padanan on m_standar.kd_padanan = tb_padanan.kd_padanan left outer join (select kd_kategori, nm_kategori1 from tb_status_standar ) as tb_status_standar1 on tb_status_standar1.kd_kategori = m_standar.kd_status_standar left outer join (select kd_status, nm_status from tbstatus ) as tbstatus on m_standar.kd_status_nspm = tbstatus.kd_status left outer join (select kd_jenisstatus, nm_jenisstatus from tbjenisstatus ) as tbjenisstatus on m_standar.kd_jenisstatus = tbjenisstatus.kd_jenisstatus left outer join (select kd_bidang, nm_bidang from mst_bidang ) as mst_bidang inner join (select kd_list_kategori, nm_list_kategori1, kd_bidang from tb_list_kategori ) as tb_list_kategori on mst_bidang.kd_bidang = tb_list_kategori.kd_bidang on m_standar.kd_list_kategori = tb_list_kategori.kd_list_kategori ) as v_standar where kd_status_standar = ".$id." and kd_jenisstatus <> '03'and kd_status_standar_gab in ('01', '02', '03') 
        and tg_kepbsn between ".$start." and ".$end."
        "; $command = YII::app()->db->createCommand($sql);
        return $command->queryScalar();
    }     

       //Menampilkan Detail dari SNI
    public static function get_detail_SNI($id){
        $sql = "
           SELECT * FROM (SELECT DISTINCT m_standar.NO_ID, m_standar.NO_NSPM, m_standar.JUDUL1, m_standar.RUANG1, m_standar.KD_GUGUS, tbgugus.NM_GUGUS, m_standar.KD_PATEK, tbpatek.NM_PATEK, m_standar.KD_SUBPATEK, tbsubpatek.NM_SUBPATEK, m_standar.KD_UNIT, tbunit.NM_UNIT, m_standar.KD_DANA, tbdana.NM_DANA, m_standar.KD_LIST_KATEGORI, tb_list_kategori.NM_LIST_KATEGORI1, m_standar.KD_JENIS_STANDAR, tbjenis_standar.NM_JENIS_STANDAR1, m_standar.KD_PADANAN, tb_padanan.NO_PADANAN, m_standar.TGL_USUL, m_standar.TGL_RSNI1, m_standar.TGL_RSNI2, m_standar.TGL_RSNI3, m_standar.TGL_RSNI4, m_standar.NO_KEPBSN, m_standar.TG_KEPBSN, m_standar.KD_STATUS_STANDAR, tb_status_standar1.NM_KATEGORI1, m_standar.KD_STATUS_NSPM, tbstatus.NM_STATUS, m_standar.kd_jenisstatus, tbjenisstatus.NM_JENISSTATUS, m_standar.BERLAKU, m_standar.TGL_PANTEK, m_standar.LOG_REVISI, m_standar.TGL_SAVE, m_standar.TGL_UPDATE, m_standar.USER_ID, m_standar.JUDUL1 + ' - ' + m_standar.RUANG1 AS textcari, m_standar.LP_perencanAan, m_standar.LP_desain, m_standar.LP_kontruksi, m_standar.lp_om, m_standar.tgl_usulbsn, m_standar.tgl_bsn, m_standar.jmlhal, m_standar.NO_NSPM_REV, m_standar.no_revisi, m_standar.status_rev, m_standar.NO_ICS, v_ics_tampil.NAMA_SUBSUBICS, m_standar.statusws, m_standar.statustek, m_standar.d_acuan, m_standar.d_pendamping, tb_padanan.DESKRIPSI AS deskripsi_padanan, m_standar.d_terkait, m_standar.tahap_usulan, m_standar.tahap_konsep, m_standar.tahap_rpt_teknis1, m_standar.tahap_rpt_teknis2, m_standar.tahap_rpt_konsensus, m_standar.tahap_rpt_pantek, m_standar.tahap_usulan_menteri, m_standar.tahap_usulan_bsn, m_standar.tahap_jajak_pendapat, m_standar.tahap_ebaloting, m_standar.jangka_waktu, m_standar.tgl_konsep, m_standar.tgl_rpt_teknis1, m_standar.tgl_rpt_teknis2, m_standar.tgl_rpt_konsensus, m_standar.tgl_rpt_pantek, m_standar.tgl_usulan_thp_menteri, m_standar.tgl_usulan_thp_bsn, m_standar.tgl_jajak_pendapat, m_standar.tgl_ebaloting, m_standar.revisi_dari_spm, tb_list_kategori.kd_bidang, mst_bidang.nm_bidang, m_standar.thn_penetapan_rsni, m_standar.no_kepmen_rsni, m_standar.kd_kat_standar_konsep, m_standar.no_nspm_konsep, v_ics_tampil.KD_ICS, v_ics_tampil.KD_SUBICS, tb_status_standar_2.NM_KATEGORI1 AS NM_KAT_STATUS_STANDAR, CASE WHEN (m_standar.no_nspm IS NOT NULL AND m_standar.no_nspm <> '') THEN m_standar.no_nspm ELSE m_standar.no_nspm_konsep END AS no_nspm_gab, CASE WHEN (m_standar.kd_status_standar IS NOT NULL AND m_standar.kd_status_standar <> '') THEN m_standar.kd_status_standar ELSE CASE WHEN m_standar.thn_penetapan_rsni IS NOT NULL AND m_standar.thn_penetapan_rsni <> '' THEN m_standar.kd_kat_standar_konsep ELSE '10'END END AS kd_status_standar_gab, CASE WHEN (tb_status_standar1.nm_kategori1 IS NOT NULL AND tb_status_standar1.nm_kategori1 <> '') THEN tb_status_standar1.nm_kategori1 ELSE tb_status_standar_2.NM_KATEGORI1 END AS nm_status_standar_gab, m_standar_1.JUDUL1 AS judul_spm_revisi, m_standar.d_ics, m_standar.d_sni_revisi, m_standar.d_stdacuan, m_standar.d_bibliografi, m_standar.regulasi, m_standar.konseptor, m_standar.kesepakatan_regional, m_standar.kebutuhan_pasar, m_standar.pertimbangan_lain, m_standar.penelitian, m_standar.tgl_usulan_menteri, m_standar.ket_jajak_pendapat, m_standar.ket_ebaloting, m_standar.no_sk_abolisi, m_standar.strata_penggunaan_sni, m_standar.std_non_internasional, m_standar.file_isi, m_standar.file_ringkasan FROM m_standar AS m_standar LEFT OUTER JOIN (SELECT revisi_dari_spm, JUDUL1, NO_NSPM FROM m_standar AS m_standar_2 WHERE (NO_NSPM <> '') ) AS m_standar_1 ON m_standar.revisi_dari_spm = m_standar_1.NO_NSPM LEFT OUTER JOIN (SELECT KD_KATEGORI, NM_KATEGORI1 FROM tb_status_standar ) AS tb_status_standar_2 ON m_standar.kd_kat_standar_konsep = tb_status_standar_2.KD_KATEGORI LEFT OUTER JOIN (SELECT KD_SUBSUB_ICS, NAMA_SUBSUBICS, kd_ics, kd_subics FROM v_ics_tampil ) AS v_ics_tampil ON m_standar.NO_ICS = v_ics_tampil.kd_subsub_ics LEFT OUTER JOIN (SELECT KD_GUGUS, NM_GUGUS FROM tbgugus ) AS tbgugus ON m_standar.KD_GUGUS = tbgugus.KD_GUGUS LEFT OUTER JOIN (SELECT KD_PATEK, NM_PATEK FROM tbpatek ) AS tbpatek ON m_standar.KD_PATEK = tbpatek.KD_PATEK LEFT OUTER JOIN (SELECT KD_sUBPATEK, NM_SUBPATEK FROM tbsubpatek ) AS tbsubpatek ON m_standar.KD_SUBPATEK = tbsubpatek.KD_SUBPATEK LEFT OUTER JOIN (SELECT KD_UNIT, NM_UNIT FROM tbunit ) AS tbunit ON m_standar.KD_UNIT = tbunit.KD_UNIT LEFT OUTER JOIN (SELECT KD_DANA, NM_DANA FROM tbdana ) AS tbdana ON m_standar.KD_DANA = tbdana.KD_DANA LEFT OUTER JOIN (SELECT KD_JENIS_STANDAR, NM_JENIS_STANDAR1 FROM tbjenis_standar ) AS tbjenis_standar ON m_standar.KD_JENIS_STANDAR = tbjenis_standar.KD_JENIS_STANDAR LEFT OUTER JOIN (SELECT KD_PADANAN, NO_PADANAN, DESKRIPSI FROM tb_padanan ) AS tb_padanan ON m_standar.KD_PADANAN = tb_padanan.KD_PADANAN LEFT OUTER JOIN (SELECT KD_KATEGORI, NM_KATEGORI1 FROM tb_status_standar ) AS tb_status_standar1 ON tb_status_standar1.KD_KATEGORI = m_standar.KD_STATUS_STANDAR LEFT OUTER JOIN (SELECT KD_STATUS, NM_STATUS FROM tbstatus ) AS tbstatus ON m_standar.KD_STATUS_NSPM = tbstatus.KD_STATUS LEFT OUTER JOIN (SELECT KD_JENISSTATUS, NM_JENISSTATUS FROM tbjenisstatus ) AS tbjenisstatus ON m_standar.kd_jenisstatus = tbjenisstatus.KD_JENISSTATUS LEFT OUTER JOIN (SELECT KD_BIDANG, NM_BIDANG FROM mst_bidang ) AS mst_bidang INNER JOIN (SELECT KD_LIST_KATEGORI, NM_LIST_KATEGORI1, kd_bidang FROM tb_list_kategori ) AS tb_list_kategori ON mst_bidang.kd_bidang = tb_list_kategori.kd_bidang ON m_standar.KD_LIST_KATEGORI = tb_list_kategori.KD_LIST_KATEGORI ) AS v_standar WHERE no_id = ".$id." 
        "; $command = YII::app()->db->createCommand($sql);
        return $command->queryAll();
    }    

    //Menampilkan List Kategori SNI
    public static function get_tipe_listkatsni(){
        $sql = "select nm_list_kategori1 as nama from tb_list_kategori order by nm_list_kategori1";
        $command = YII::app()->db->createCommand($sql);
        return $command->queryAll();
    }
    
    //Menampilkan List Standar
    public static function get_jenis_standar(){
        $sql = "select kd_jenis_standar,nm_jenis_standar1 from tbjenis_standar order by kd_jenis_standar";
        $command = YII::app()->db->createCommand($sql);
        return $command->queryAll();
    }
    
    //Menampilkan List Kategori
    public static function get_kategori($kd_kategori){
        $sql = "select a.nm_kategori1,b.* from tb_status_standar a,tb_ststandardesc b 
        where a.kd_kategori=b.kd_kategori and b.kd_kategori='$kd_kategori'
        order by b.kd_kategori ";
        $command = YII::app()->db->createCommand($sql);
        return $command->queryAll();
    }

    //Menampilkan Nama dari Kode Jenis Standar
    public static function type($data){
        if($data=="01"){
            return "SNI";
        }elseif($data=="02"){
            return "Pedoman Teknis";
        }elseif($data=="03"){
            return "Petunjuk Teknis";
        }else{
            return "-";
        }
    }

    // Show SNI : Menampilkan Dokumen Terpopuler
    public static function getPopularStandar(){
        $sql = "
        select a.*, judul1 as judul, no_nspm_gab as no_nspm from (select count(distinct id_user_register) as jmluserdownload, judul1, id_spm, no_nspm_gab from (select tm_download_pemesanan.id, tm_download_pemesanan.tanggal_download, tm_user_register.nama, tm_download_pemesanan.flag_download, v_standar.no_nspm_gab, v_standar.judul1, tm_user_register.id_bidang_pekerjaan, tr_bidang_pekerjaan.bidangpekerjaan, tm_user_register.id_jenis_pekerjaan, tr_jenis_pekerjaan.jenispekerjaan, tm_download_pemesanan.id_spm, tm_download_pemesanan.id_user_register, v_standar.kd_subpatek, v_standar.nm_subpatek, v_standar.kd_list_kategori, v_standar.nm_list_kategori1, v_standar.kd_bidang, v_standar.nm_bidang from (select id, id_spm, tanggal_download, id_user_register, flag_download from tm_download_pemesanan ) tm_download_pemesanan inner join (select id, nama, id_jenis_pekerjaan, id_bidang_pekerjaan from tm_user_register ) tm_user_register on tm_download_pemesanan.id_user_register = tm_user_register.id inner join (select distinct m_standar.no_id, m_standar.no_nspm, m_standar.judul1, m_standar.ruang1, m_standar.kd_patek, tbpatek.nm_patek, m_standar.kd_subpatek, tbsubpatek.nm_subpatek, m_standar.kd_list_kategori, tb_list_kategori.nm_list_kategori1, m_standar.kd_jenis_standar, tbjenis_standar.nm_jenis_standar1, m_standar.kd_padanan, tb_padanan.no_padanan, m_standar.kd_status_standar, tb_status_standar1.nm_kategori1, m_standar.kd_status_nspm, tbstatus.nm_status, m_standar.kd_jenisstatus, tbjenisstatus.nm_jenisstatus, m_standar.berlaku, m_standar.tgl_pantek, m_standar.log_revisi, m_standar.tgl_save, m_standar.tgl_update, m_standar.user_id, m_standar.judul1 + ' - ' + m_standar.ruang1 as textcari, m_standar.no_ics, v_ics_tampil.nama_subsubics, tb_padanan.deskripsi as deskripsi_padanan, m_standar.revisi_dari_spm, tb_list_kategori.kd_bidang, mst_bidang.nm_bidang, m_standar.kd_kat_standar_konsep, m_standar.no_nspm_konsep, v_ics_tampil.kd_ics, v_ics_tampil.kd_subics, tb_status_standar_2.nm_kategori1 as nm_kat_status_standar, case when (m_standar.no_nspm is not null and m_standar.no_nspm <> '') then m_standar.no_nspm else m_standar.no_nspm_konsep end as no_nspm_gab, case when (m_standar.kd_status_standar is not null and m_standar.kd_status_standar <> '') then m_standar.kd_status_standar else case when m_standar.thn_penetapan_rsni is not null and m_standar.thn_penetapan_rsni <> '' then m_standar.kd_kat_standar_konsep else '10'end end as kd_status_standar_gab, case when (tb_status_standar1.nm_kategori1 is not null and tb_status_standar1.nm_kategori1 <> '') then tb_status_standar1.nm_kategori1 else tb_status_standar_2.nm_kategori1 end as nm_status_standar_gab, m_standar_1.judul1 as judul_spm_revisi, m_standar.d_ics, m_standar.d_sni_revisi, m_standar.d_stdacuan, m_standar.strata_penggunaan_sni, m_standar.std_non_internasional, m_standar.file_isi, m_standar.file_ringkasan from m_standar as m_standar left outer join (select revisi_dari_spm, judul1, no_nspm from m_standar as m_standar_2 where (no_nspm <> '') ) as m_standar_1 on m_standar.revisi_dari_spm = m_standar_1.no_nspm left outer join (select kd_kategori, nm_kategori1 from tb_status_standar ) as tb_status_standar_2 on m_standar.kd_kat_standar_konsep = tb_status_standar_2.kd_kategori left outer join (select kd_subsub_ics, nama_subsubics, kd_ics, kd_subics from v_ics_tampil ) as v_ics_tampil on m_standar.no_ics = v_ics_tampil.kd_subsub_ics left outer join (select kd_patek, nm_patek from tbpatek ) as tbpatek on m_standar.kd_patek = tbpatek.kd_patek left outer join (select kd_subpatek, nm_subpatek from tbsubpatek ) as tbsubpatek on m_standar.kd_subpatek = tbsubpatek.kd_subpatek left outer join (select kd_jenis_standar, nm_jenis_standar1 from tbjenis_standar ) as tbjenis_standar on m_standar.kd_jenis_standar = tbjenis_standar.kd_jenis_standar left outer join (select kd_padanan, no_padanan, deskripsi from tb_padanan ) as tb_padanan on m_standar.kd_padanan = tb_padanan.kd_padanan left outer join (select kd_kategori, nm_kategori1 from tb_status_standar ) as tb_status_standar1 on tb_status_standar1.kd_kategori = m_standar.kd_status_standar left outer join (select kd_status, nm_status from tbstatus ) as tbstatus on m_standar.kd_status_nspm = tbstatus.kd_status left outer join (select kd_jenisstatus, nm_jenisstatus from tbjenisstatus ) as tbjenisstatus on m_standar.kd_jenisstatus = tbjenisstatus.kd_jenisstatus left outer join (select kd_bidang, nm_bidang from mst_bidang ) as mst_bidang inner join (select kd_list_kategori, nm_list_kategori1, kd_bidang from tb_list_kategori ) as tb_list_kategori on mst_bidang.kd_bidang = tb_list_kategori.kd_bidang on m_standar.kd_list_kategori = tb_list_kategori.kd_list_kategori ) v_standar on tm_download_pemesanan.id_spm = v_standar.no_id inner join tr_jenis_pekerjaan on tm_user_register.id_jenis_pekerjaan = tr_jenis_pekerjaan.id inner join tr_bidang_pekerjaan on tm_user_register.id_bidang_pekerjaan = tr_bidang_pekerjaan.id ) as x group by judul1, id_spm, no_nspm_gab ) a order by jmluserdownload desc limit 4 offset 0 
        ";
        $command = YII::app()->db->createCommand($sql);
        return $command->queryAll();
    }     




}
